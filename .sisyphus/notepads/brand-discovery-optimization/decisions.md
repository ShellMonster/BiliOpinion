# 品牌发现优化 - 技术决策记录

## 决策1: 从"确认模式"改为"发现模式"

**问题**: 用户无法预知市场上所有品牌，白名单过滤导致数据丢失

**方案**: 
- 收集所有AI识别的品牌
- 分类为"指定品牌"和"发现品牌"
- 在日志和报告中标记发现的品牌

**权衡**:
- ✅ 优点: 用户看到完整市场情况，不遗漏竞品
- ⚠️ 风险: 可能引入噪音品牌
- 🛡️ 缓解: 通过品牌归一化和前端标记解决

**实施**: `backend/task/executor.go` lines 362-438

---

## 决策2: 生成通用搜索关键词

**问题**: "小佩自动猫砂盆"只能找到小佩相关视频

**方案**:
- 保留品牌特定关键词（3-5个）
- 新增通用关键词（4个）：评测、推荐、横评、对比

**权衡**:
- ✅ 优点: 能找到所有品牌的横评视频
- ⚠️ 风险: 可能引入无关视频
- 🛡️ 缓解: 配合视频时长过滤

**实施**: `backend/ai/keyword.go` lines 53-62

---

## 决策3: 增加数据抓取量

**问题**: 10个视频、100条评论覆盖率太低

**方案**:
- 视频数量: 10 → 20
- 评论数量: 100 → 200
- 并发数: 3 → 5
- AI批次: 5 → 10

**权衡**:
- ✅ 优点: 数据质量显著提升
- ⚠️ 风险: 分析时间增加
- 🛡️ 缓解: 通过并发优化和批次优化

**实施**: `backend/task/executor.go` lines 37-42

---

## 决策4: 过滤短视频

**问题**: 短视频（<1分钟）通常没有深度评测

**方案**:
- 添加 `parseDuration` 函数解析时长
- 过滤时长 < 60秒的视频

**权衡**:
- ✅ 优点: 提高评测视频质量
- ⚠️ 风险: 可能过滤掉一些有价值的短评测
- 🛡️ 缓解: 60秒是合理阈值，平衡质量和覆盖

**实施**: `backend/bilibili/search.go` line 197

---

## 决策5: 品牌归一化

**问题**: AI可能识别出不同的品牌别名（Apple vs 苹果）

**方案**:
- 添加 `normalizeBrand` 函数
- 处理常见品牌别名映射

**权衡**:
- ✅ 优点: 提高品牌识别准确性
- ⚠️ 风险: 硬编码别名列表需要维护
- 🛡️ 缓解: 只处理最常见的品牌，可扩展

**实施**: `backend/task/executor.go` line 559

---

## 决策6: 前端标记发现的品牌

**问题**: 用户无法区分哪些品牌是自己指定的，哪些是AI发现的

**方案**:
- 在品牌排名表格中添加 🔍 图标
- 鼠标悬停显示 tooltip

**权衡**:
- ✅ 优点: 清晰的视觉区分
- ⚠️ 风险: 可能影响UI美观
- 🛡️ 缓解: 使用简洁的图标和tooltip

**实施**: `frontend/src/pages/Report.tsx` lines 480-487
