# 问题分析：型号解析为"通用"和品牌包含"/"

## 问题现象

从报告 ID=6 的数据分析：

### 问题1：大量型号为"通用"
- 总型号数：76
- "通用"型号数：38 (50%)
- 这意味着一半的评论没有成功提取到具体型号

### 问题2：品牌包含"/"分隔符
发现的异常品牌：
- `喵洁易/Catlink` - 实际是2个品牌
- `宜宝/notty` - 实际是2个品牌
- `鸟语花香/Catlink` - 实际是2个品牌
- `小佩/宜宝` - 实际是2个品牌
- `有陪/小佩/小米/糯雪` - 实际是4个品牌！

## 根本原因分析

### 原因1：AI提示词不够明确

当前提示词（`backend/ai/analysis.go:411-425`）：
```
你是商品评论分析助手。分析以下多条评论，为每条评论：
1. 提取品牌名称和具体型号
2. 对以下维度打分...

重要规则：
- 无法确定品牌填"未知"，无法确定型号填"通用"
```

**问题**：
1. 没有明确告诉AI"品牌必须是单一品牌，不能用/分隔多个品牌"
2. 没有告诉AI如何处理对比类评论（如"小佩比宜宝好"）
3. 没有提供已知品牌列表作为参考

### 原因2：缺少后处理逻辑

当前代码没有对AI返回的品牌/型号做任何清洗：
- 没有检测和拆分"/"分隔的品牌
- 没有验证品牌是否在已知列表中
- 没有处理"通用"型号的情况

## 数据流分析

```
评论内容 → AI分析 → 返回 {brand, model, scores}
                         ↓
                    直接存储（无清洗）
                         ↓
                    报告生成（按brand+model聚合）
```

## 解决方案建议

### 方案A：优化AI提示词（推荐）

修改 `backend/ai/analysis.go` 中的提示词：

```
重要规则：
- 品牌必须是单一品牌名称，不能包含"/"或其他分隔符
- 如果评论对比多个品牌，选择评论主要讨论的那个品牌
- 如果评论同时讨论多个品牌且无法确定主要品牌，brand填"未知"
- 型号必须是具体型号名（如"V12"、"Max"），不能是描述性文字
- 已知品牌参考：{品牌列表}
```

### 方案B：添加后处理逻辑

在 `backend/task/executor.go` 或 `backend/report/generator.go` 中添加：

```go
// 清洗品牌名称
func cleanBrandName(brand string, knownBrands []string) string {
    // 1. 如果包含"/"，尝试拆分并匹配已知品牌
    if strings.Contains(brand, "/") {
        parts := strings.Split(brand, "/")
        for _, part := range parts {
            part = strings.TrimSpace(part)
            if contains(knownBrands, part) {
                return part
            }
        }
        // 如果都不匹配，返回第一个
        return strings.TrimSpace(parts[0])
    }
    return brand
}
```

### 方案C：改进型号提取

对于"通用"型号，可以：
1. 从视频标题中提取型号信息
2. 使用正则匹配常见型号模式（如"V12"、"Max"、"Pro"等）
3. 如果评论提到具体型号但AI没识别，进行二次提取

## 推荐实施顺序

1. **短期**：方案B - 添加后处理逻辑，清洗"/"分隔的品牌
2. **中期**：方案A - 优化AI提示词，减少问题产生
3. **长期**：方案C - 改进型号提取逻辑

## 影响范围

- `backend/ai/analysis.go` - AI提示词
- `backend/task/executor.go` - 评论分析后处理
- `backend/report/generator.go` - 报告生成时的数据清洗

## 待确认问题

1. 是否需要对历史数据进行修复？
2. 品牌拆分后，评分如何分配？（复制到每个品牌？还是只保留第一个？）
3. "通用"型号是否需要特殊处理（如不参与型号排名）？
